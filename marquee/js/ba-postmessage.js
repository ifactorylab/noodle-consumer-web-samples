/*
 * jQuery postMessage - v0.5 - 9/11/2009
 * http://benalman.com/projects/jquery-postmessage-plugin/
 * 
 * Copyright (c) 2009 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
(function($){var interval_id,last_hash,cache_bust=1,rm_callback,window=this,FALSE=!1,postMessage="postMessage",addEventListener="addEventListener",p_receiveMessage,has_postMessage=window[postMessage]&&!$.browser.opera;$[postMessage]=function(message,target_url,target){if(!target_url){return}message=typeof message==="string"?message:$.param(message);target=target||parent;if(has_postMessage){target[postMessage](message,target_url.replace(/([^:]+:\/\/[^\/]+).*/,"$1"))}else{if(target_url){target.location=target_url.replace(/#.*$/,"")+"#"+(+new Date)+(cache_bust++)+"&"+message}}};$.receiveMessage=p_receiveMessage=function(callback,source_origin,delay){if(has_postMessage){if(callback){rm_callback&&p_receiveMessage();rm_callback=function(e){if((typeof source_origin==="string"&&e.origin!==source_origin)||($.isFunction(source_origin)&&source_origin(e.origin)===FALSE)){return FALSE}callback(e)}}if(window[addEventListener]){window[callback?addEventListener:"removeEventListener"]("message",rm_callback,FALSE)}else{window[callback?"attachEvent":"detachEvent"]("onmessage",rm_callback)}}else{interval_id&&clearInterval(interval_id);interval_id=null;if(callback){delay=typeof source_origin==="number"?source_origin:typeof delay==="number"?delay:100;interval_id=setInterval(function(){var hash=document.location.hash,re=/^#?\d+&/;if(hash!==last_hash&&re.test(hash)){last_hash=hash;callback({data:hash.replace(re,"")})}},delay)}}}})(jQuery);function HandleChildWindowMessage(e){switch(e.data.split("||")[0]){case"signInPopup":var url=e.data.split("||")[1];url=url+"#TB_iframe=true&height=320&width=300&modal=false";tb_remove_then_show("",url,false,true,null);break;case"registerPopup":var url=e.data.split("||")[1];url=url+"#TB_iframe=true&height=550&width=370&modal=false";tb_remove_then_show("",url,false,true,null);break;case"showFbLogin":document.getElementById("TB_window").style.display="none";jQuery("#TB_overlay,#TB_title, #TB_HideSelect").trigger("unload").unbind().remove();break;case"cancel":break;case"converted":var viewPageUrl="PAGE_URL?iid=IID_VAL&resoC=RESOC_VAL&rgt=1&anon=1&suem=1";var currentPageUrl=location.href;if(currentPageUrl.indexOf("?")>0){currentPageUrl=currentPageUrl.substring(0,currentPageUrl.indexOf("?"))}viewPageUrl=viewPageUrl.replace("PAGE_URL",currentPageUrl);var iid=location.href.substring(location.href.indexOf("iid=")+4);if(iid.indexOf("&")>0){iid=iid.substring(0,iid.indexOf("&"))}viewPageUrl=viewPageUrl.replace("IID_VAL",iid);var messages=e.data.split("||");var resoC;if(messages.length>=3){resoC=e.data.split("||")[2]}else{location.href.substring(location.href.indexOf("resoC=")+6);if(resoC.indexOf("&")>0){resoC=resoC.substring(0,resoC.indexOf("&"))}}viewPageUrl=viewPageUrl.replace("RESOC_VAL",resoC);location.href=viewPageUrl;break;case"refresh":if(window.location.href.toLowerCase().indexOf("/logout.aspx")>-1){location.href="/";return}if(window.location.href.toLowerCase().indexOf("/login.aspx")==-1&&window.location.href.toLowerCase().indexOf("/register.aspx")==-1){var currentUrl=location.href;if(currentUrl.indexOf("#addToWlIe")>0){if(currentUrl.indexOf("?")>0){currentUrl=currentUrl.split("#addToWlIe")[0]+"&addToWl=1&welcome=1"}else{currentUrl=currentUrl.split("#addToWlIe")[0]+"?addToWl=1&welcome=1"}}else{if(currentUrl.indexOf("?")>0){currentUrl=currentUrl+"&welcome=1"}else{currentUrl=currentUrl+"?welcome=1"}}location.href=currentUrl;return}var resultsData=e.data.split("||")[1];var userInfo=JSON.parse(resultsData);hfSignInAction.value=hfSignInAction.value.replace("[OtUserId]",userInfo.OtUserId);hfSignInAction.value=hfSignInAction.value.replace("[IsCaller]",userInfo.IsCaller);eval(hfSignInAction.value);jQuery("#ProcessingOverlay").hide();break;case"MustConfirm":var resultsData=e.data.split("||")[1];var userInfo=JSON.parse(resultsData);var loginSocialPopUpUrl="LoginSocialPopup.aspx?soctype=1&authToken=AUTH_TOKEN&fn=FIRST_NAME&ln=LAST_NAME&em=EMAIL&rp=REFPAGE#TB_iframe=true&height=320&width=300&modal=false";loginSocialPopUpUrl=loginSocialPopUpUrl.replace("AUTH_TOKEN",userInfo.AuthToken);loginSocialPopUpUrl=loginSocialPopUpUrl.replace("FIRST_NAME",userInfo.FirstName);loginSocialPopUpUrl=loginSocialPopUpUrl.replace("LAST_NAME",userInfo.LastName);loginSocialPopUpUrl=loginSocialPopUpUrl.replace("EMAIL",userInfo.Email);loginSocialPopUpUrl=loginSocialPopUpUrl.replace("REFPAGE",window.location.href);tb_remove_then_show("",loginSocialPopUpUrl,false,true,null);break;default:break}};